# home.nix
{ config, pkgs, ... }:

{
  home.username = "nixos";
  home.homeDirectory = "/home/nixos";
  home.stateVersion = "25.05";

  # fonts for icons (Waybar, etc.)
  fonts.fontconfig.enable = true;

  home.packages = with pkgs; [
    # CLI basics
    bash-completion bat btop curl eza fastfetch fd fzf git gh inetutils less jq
    lazygit man nushell plocate ripgrep neovim tldr unzip whois yazi zoxide

    # Wayland/Hyprland helpers
    wl-clipboard grim slurp swaybg xdg-utils

    # terminals + Xwayland for X11 apps
    foot xterm xwayland

    # icon fonts (optional but nice)
    font-awesome nerd-fonts.symbols-only
  ];

  # Apps used by binds/desktop
  programs.wofi.enable = true;
  programs.ghostty.enable = true;
  services.mako.enable = true;
  services.lxqt-policykit-agent.enable = true;

  # Hyprland via Home Manager
  wayland.windowManager.hyprland = {
    enable = true;
    settings = {
      "$mod" = "SUPER";
      monitor = ",preferred,auto,1";

      exec-once = [
        "waybar"
        "lxqt-policykit-agent"
        "mako"
        "swaybg -i /run/current-system/sw/share/backgrounds/nixos/nix-wallpaper-simple-blue.png"
      ];

      bind = [
        # Main terminal (Ghostty via X11 + non-GL renderer for VM stability)
        "$mod, Return, exec, env -u GDK_DEBUG GDK_BACKEND=x11 GSK_RENDERER=cairo ghostty"

        # Backups
        "$mod SHIFT, Return, exec, foot"
        ", F12, exec, xterm"
        ", F10, exec, wofi --show drun"

        # Other handy binds
        "$mod, D, exec, wofi --show drun"
        "$mod, Q, killactive,"
        "$mod SHIFT, E, exit,"
        "$mod, F, fullscreen,"
      ];
    };
  };

  # Waybar with a clickable "Menu" button
  programs.waybar = {
    enable = true;
    settings = [{
      layer = "top";
      position = "top";
      modules-left = [ "custom/menu" "hyprland/workspaces" ];
      modules-center = [ "clock" ];
      modules-right = [ "pulseaudio" "network" "cpu" "memory" "battery" ];

      "custom/menu" = {
        "format" = "Menu";               # swap to an icon later if you want
        "tooltip" = false;
        "on-click" = "wofi --show drun";
        "on-click-right" = "wofi --show run";
      };
    }];
    style = ''
      #custom-menu { padding: 0 12px; font-size: 16px; }
    '';
  };

  # Optional launcher entry so Wofi shows an explicit X11 Ghostty
  xdg.enable = true;
  xdg.desktopEntries."ghostty-x11" = {
    name = "Ghostty (X11 fallback)";
    exec = "env -u GDK_DEBUG GDK_BACKEND=x11 GSK_RENDERER=cairo ghostty";
    terminal = false;
    categories = [ "System" "TerminalEmulator" ];
  };
}
